#!/bin/bash

is_command_exists() {
    command -v "$1" &> /dev/null
}

check_yaml_key() {
    local yaml_file="$1"
    local yaml_key="$2"

    if [[ ! -f "$yaml_file" ]]; then
        echo "游댮 $yaml_file file not found."
        exit 1
    fi

    local value
    value=$(yq eval ".$yaml_key" "$yaml_file" 2>/dev/null)

    if [[ -z "$value" ]]; then
        echo "游댮 $yaml_key is not found in $yaml_file."
        exit 2
    fi

    if [[ "$value" == "true" ]]; then
        echo "游릭 $yaml_key is enabled (true)."
    elif [[ "$value" == "false" ]]; then
        echo "游댮 $yaml_key is disabled (false)."
    else
        echo "游댮 $yaml_key has an invalid value ($value)."
        exit 3
    fi
}


# Main
if [[ "$OSTYPE" == "darwin"* ]]; then
    echo "游리 Running on : macOS"
    
    if ! is_command_exists brew; then
        echo "游댮 Homebrew not installed. Visit https://brew.sh/ to install it"
        exit 1
    fi

    if ! is_command_exists yq; then
        echo "游리 Installing yq..."
        brew install yq
        echo "游릭 yq successfuly installed"
    else
        echo "游댯 yq is already installed."
    fi

    if ! is_command_exists jq; then
        echo "游리 Installing jq..."
        brew install jq
        echo "游릭 jq successfuly installed"
    else
        echo "游댯 jq is already installed."
    fi
elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
    echo "Running on: Linux"
    sudo apt-get update
    if ! is_command_exists yq; then
        echo "游리 Installing yq..."
        sudo apt-get install -y yq
        echo "游릭 yq successfuly installed"
    else
        echo "游댯 yq is already installed."
    fi

    if ! is_command_exists jq; then
        echo "游리 Installing jq..."
        sudo apt-get install -y jq
        echo "游릭 jq successfuly installed"
    else
        echo "游댯 jq is already installed."
    fi
else
    echo "游댮 Unsupported Operating System: $OSTYPE"
    exit 1
fi